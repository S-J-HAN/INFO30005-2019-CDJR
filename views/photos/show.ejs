<% include ../partials/header %>
<div class="container">
  <div class="row">
    <div class="col-6 col-lg-7">
      <div class="card animated animatedFadeInUp fadeInUp my-3">
        <div class="card-img-top">
        <% if(children.length > 0){ %>
          <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
              <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
              <% for (let index = 1; index < children.length; index++) { %>
              <li data-target="#carouselExampleIndicators" data-slide-to="<%= index %>"></li>
              <% } %>
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="<%= children[0] %>" class="d-block w-100" alt="...">
              </div>
              <% children.slice(1, children.length-1).forEach(element => { %>
                <div class="carousel-item">
                  <img src="<%= element %>" class="d-block w-100" alt="...">
                </div>
              <% }); %>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        <% }else{ %>
          <img src="<%= photo.image %>" class="card-img-top">
        <% } %>
        </div>
        <div class="card-body">
          <div class="card-title title main">
            <%= photo.name %>
            <% if(currentUser && photo.author.id.equals(currentUser._id)){ %>
              <div class="form-row photo-form">
                <form class="form-group" action="/photo/<%= photo._id %>/edit" method="GET">
                  <button class="button-link" id="edit-photo">Edit</button>
                </form>
                <form class="form-group" id="delete-form" action="/photo/<%= photo._id %>?_method=DELETE" method="POST">
                  <button class="button-link" id="delete-photo">Delete</button>
                </form>
              </div>
            <% } %>
          </div>
          <div class="title sub">By <a href="/profile/<%= photo.author.username %>" id="comment-username"><%= photo.author.username %></a></div>
          <div class="title sub mb-3">Created on <%= moment(photo.postAt).format('LL') %></div>
          <div class="photoDescription"><%= photo.description %></div>
          <!-- <div class="title sub"><%= photo.labels %></div> -->
          <div>
            <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Check out this photo on #drawer" data-show-count="false">
              Tweet
            </a>
            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </div>
          <div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-size="small">
            <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">
              Facebook
            </a>
          </div>
          <div id="fb-root"></div>
          <script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_CN/sdk.js#xfbml=1&version=v3.3"></script>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-5">
      <h3 class="title subdued">comments</h3>

      <div class="CommentDetail">
        <% photo.comments.forEach(function(comment){ %>
          <% if(currentUser && comment.author.id.equals(currentUser._id)){ %>
            <div class="user-comment-header">
              <a href="/profile/<%= comment.author.username %>" id="comment-username"><%= comment.author.username %></a>
              <div class="user-alter-comment button-link">
                <form action="/photo/<%= photo._id %>/comment/<%= comment._id %>/edit" method="GET">
                  <button class="button-link edit-comment">Edit</button>
                </form>
                <form action="/photo/<%= photo._id %>/comment/<%= comment._id %>?_method=DELETE" method="POST">
                  <button class="button-link delete-comment">Delete</button>
                </form>
              </div>
            </div>
            <div class="comment-date"><%= moment(comment.postAt).format('LL') %></div>
          <% } else { %>
            <a href="/profile/<%= comment.author.username %>" id="comment-username"><%= comment.author.username %></a>
            <div class="comment-date"><%= moment(comment.postAt).format('LL') %></div>
          <% } %>
          <p class="comment-text"><%= comment.text %></p>
          <hr>
        <% })%>
        <% if (photo.comments.length == 0 && !currentUser) { %>
          <div style="font-family: Helvetica; color: #dbe2ef;">No comments yet...</div>
        <% } %>
      </div>

      <div>
        <% if(currentUser){ %>
          <a href="/profile/<%= currentUser.username %>" id="comment-username"><%= currentUser.username %></a>
          <div class="comment-date"><%= moment(new Date()).format('LL') %></div>
          <form class="form-group" action="/photo/<%= photo._id %>/comment" method="POST" id="post-comment">
                <textarea class="form-control commentInput comment-text" id="comment" rows="6" type="text" name="comment[text]" placeholder="leave a comment..." id="input-comment"></textarea>
                <button class="sortby button" type="">Submit</button>
          </form>
        <% } %>
      </div>
    </div>
  </div>
</div>

<% include ../partials/footerScript%>
<% include ../partials/footer %>
